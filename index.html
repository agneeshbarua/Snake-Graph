<!DOCTYPE html>
<html>
 <head>
   <meta charset="uff-8"></meta>
   <style> 
            .link {
             fill: none;
             stroke: #BAC0C0;
             stroke-width: 1.5px;
}

            .node {
             fill: #1f77b4;
}


            .node.fixed {
             fill: #f00;
}

        text.nodetext {
             fill: black;
             font: 20px sans-serif;
}

            .node:not(:hover) .nodetext {
              display: none;
}

       text.legendtext {
            fill: black;
            font: 20px sans-serif;
}

            
}

      ul {width: 800px; }

      text.legendTitle {
         font: 20px sans-serif;
         font-weight: bold;
           fill: black;
           text-anchor: end;
}
                                </style>

<title> Snake Graph(s) </title>

<meta name="description" content="Demo for how to build an interactive NV."></meta>
<meta name="author" content="Sasha"></meta>
<meta name="viewport" content="width=device-width,initial-scale=1"></meta>
                
                                            </head>

<body>

  <div id="container" class="container">
    <header>
    <h1>XXXXXXXX</h1>
    <ul>
    <li>XXXXXXXXX </li>
    <li> XXXXXXXXXX </li>
    <li> XXXXXXXXXX </li>
    <li> XXXXXXXXX
    </li></ul>

    </header>



      <div id="datase_selection" class="control">
        <h3>Module</h3>
        <select onchange="OnSelectionChange (this)">
        <option value="" disabled="" selected="" style="display:none;">Choose module</option>
        <option value="ga_res.json"> Module 1 Green</option>
        <option value="gya_res.json"> Module 2 Green Yellow</option>
        <option value="lya_res.json"> Module 3 Light Yellow</option>
        </select>

      </div>
  </div> <!--! end of #container -->


<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

// get selection
function OnSelectionChange (select) {
  var selectedOption = select.options[select.selectedIndex];

  // remove any previous plot
d3.select("svg").remove();
var width = 1200,
    height = 800;


  
  var force = d3.layout.force()
      .linkDistance(200)
      .chargeDistance(300)
      .gravity(.1)
      .charge(-300)
      .size([width, height]);

  var drag = force.drag()
      .on("dragstart", dragstart);

  // undo fix with double click
  function dblclick(d) {
    d3.select(this).classed("fixed", d.fixed = false);
  }

  // fix node by dragging
  function dragstart(d) {
    d3.select(this).classed("fixed", d.fixed = true);
  }

  var svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height);

  d3.json(selectedOption.value, function(error, graph) {

    force
        .nodes(graph.nodes)
        .links(graph.links)
        .start();

  var colour =d3.scale.category20c()
        .domain("10","9","8","7","6","5")
        .range(["#3182bd", "#6baed6", "#9ecae1", "#c6dbef", "#9e9ac8", "#d9d9d9"]);



    var link = svg.selectAll(".link")
        .data(graph.links)
        .enter().append("line")
        .attr("class", "link");
        // .style("stroke-width", function(d) { return Math.sqrt(d.value); });
        // .style("stroke-width", function(d) { return d.value });

    var node = svg.selectAll(".node")
        .data(graph.nodes)
        .enter().append("g")
        .attr("class", "node")
        .call(force.drag)
        .on("dblclick", dblclick);

    // add the nodes
    node.append("circle")
            .attr("class", "node")
            .attr("r", function(d) {return (d.v*1.5); }) //r of circle nodes based on data.
            .style("fill", function(d) { return colour(d.v); }) //colour of circle nodes based on data.
            .style("stroke", "black")
            .on("dblclick", dblclick)
            .call(force.drag);


    // adding text
    node.append("text")
        .attr("class", "nodetext")
        .attr("x", 12)
        .attr("dy", ".35em")
        .text(function(d) { return d.name; });

    force.on("tick", function() {
        // Updating the links
        link.attr("x1", function(d) { return d.source.x; })
          .attr("y1", function(d) { return d.source.y; })
          .attr("x2", function(d) { return d.target.x; })
          .attr("y2", function(d) { return d.target.y; });

        // Translate the groups
        node.attr("transform", function(d) {
          return 'translate(' + [d.x, d.y] + ')';
        });
    });
    node.on('mouseover', function(d) {
      link.style('stroke', function(l) {
        if (d === l.source || d === l.target)
          return '#FF5050';
        else
          return '#BAC0C0';
        });
    });

    // Set the stroke width back to normal when mouse leaves the node.
    node.on('mouseout', function() {
      link.style('stroke', '#BAC0C0');
    });


    // Add a legend for the size of the circles
    var padding=3;

    var legend = svg.selectAll(".legend")
        .data([5,6,7,8,9,10])
        .enter().append("g")
        .attr("class", "legend")
        .attr("transform", function (d, i) {
        return "translate(0," + i * 20 + ")";
    });
    

    legend.append("circle")
        .attr("cx", width - 18)
        .attr("cy", 40)
        .attr("r", function (d) {return (d*2) - padding;})
        .style("fill", function(d) { return colour(d); })
        .style("stroke", "black");


    legend.append("text")
        .attr("class", "legendtext")
        .attr("x", width - 32)
        .attr("y", 45)
        .style("text-anchor", "end")
        .text(function (d) {return d; });

    var legendTitle = svg.selectAll(".legendTitle")
        .data([0])
        .enter().append("g")
        .append("text")
        .attr("class", "legendTitle")
        .text("10^-1")
        .attr("x", width )
        .attr("y", 25);


  });
};
</script>

<script src="javascripts/scale.fix.js"></script>
          <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      </script><script src="http://www.google-analytics.com/ga.js" type="text/javascript"></script>
      <script type="text/javascript">
        try {
          var pageTracker = _gat._getTracker("UA-45186360-9");
        pageTracker._trackPageview();
        } catch(err) {}
      </script>
</body>
